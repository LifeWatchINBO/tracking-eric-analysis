function mergeRecursive(e,t){"use strict";for(var n in t){try{if(t[n].constructor===Object){e[n]=mergeRecursive(e[n],t[n])}else{e[n]=t[n]}}catch(r){e[n]=t[n]}}return e}function arrayEquals(e,t){"use strict";if(!t||!e){return false}if(e.length!==t.length){return false}for(var n=0;n<e.length;n++){if(e[n]instanceof Array&&t[n]instanceof Array){if(!arrayEquals(e[n],t[n])){return false}}else if(e[n]!==t[n]){return false}}return true}var d3=typeof require==="function"?require("d3"):window.d3;var CalHeatMap=function(){"use strict";function r(){e.verticalDomainLabel=e.options.label.position==="top"||e.options.label.position==="bottom";e.domainVerticalLabelHeight=e.options.label.height===null?Math.max(25,e.options.cellSize*2):e.options.label.height;e.domainHorizontalLabelWidth=0;if(e.options.domainLabelFormat===""&&e.options.label.height===null){e.domainVerticalLabelHeight=0}if(!e.verticalDomainLabel){e.domainVerticalLabelHeight=0;e.domainHorizontalLabelWidth=e.options.label.width}e.paint();if(e.options.nextSelector!==false){d3.select(e.options.nextSelector).on("click."+e.options.itemNamespace,function(){d3.event.preventDefault();return e.loadNextDomain(1)})}if(e.options.previousSelector!==false){d3.select(e.options.previousSelector).on("click."+e.options.itemNamespace,function(){d3.event.preventDefault();return e.loadPreviousDomain(1)})}e.Legend.redraw(e.graphDim.width-e.options.domainGutter-e.options.cellPadding);e.afterLoad();var t=e.getDomainKeys();if(e.options.loadOnInit){e.getDatas(e.options.data,new Date(t[0]),e.getSubDomain(t[t.length-1]).pop(),function(){e.fill();e.onComplete()})}else{e.onComplete()}e.checkIfMinDomainIsReached(t[0]);e.checkIfMaxDomainIsReached(e.getNextDomain().getTime())}function i(t,n){var r=e.options.cellSize*e._domainType[e.options.subDomain].column(t)+e.options.cellPadding*e._domainType[e.options.subDomain].column(t);if(arguments.length===2&&n===true){return r+=e.domainHorizontalLabelWidth+e.options.domainGutter+e.options.domainMargin[1]+e.options.domainMargin[3]}return r}function s(t,n){var r=e.options.cellSize*e._domainType[e.options.subDomain].row(t)+e.options.cellPadding*e._domainType[e.options.subDomain].row(t);if(arguments.length===2&&n===true){r+=e.options.domainGutter+e.domainVerticalLabelHeight+e.options.domainMargin[0]+e.options.domainMargin[2]}return r}var e=this;this.allowedDataType=["json","csv","tsv","txt"];this.options={itemSelector:"#cal-heatmap",paintOnLoad:true,range:12,cellSize:10,cellPadding:2,cellRadius:0,domainGutter:2,domainMargin:[0,0,0,0],domain:"hour",subDomain:"min",colLimit:null,rowLimit:null,weekStartOnMonday:true,start:new Date,minDate:null,maxDate:null,data:"",dataType:this.allowedDataType[0],considerMissingDataAsZero:false,loadOnInit:true,verticalOrientation:false,domainDynamicDimension:true,label:{position:"bottom",align:"center",offset:{x:0,y:0},rotate:null,width:100,height:null},legend:[10,20,30,40],displayLegend:true,legendCellSize:10,legendCellPadding:2,legendMargin:[0,0,0,0],legendVerticalPosition:"bottom",legendHorizontalPosition:"left",legendOrientation:"horizontal",legendColors:null,highlight:[],itemName:["item","items"],domainLabelFormat:null,subDomainTitleFormat:{empty:"{date}",filled:"{count} {name} {connector} {date}"},subDomainDateFormat:null,subDomainTextFormat:null,legendTitleFormat:{lower:"less than {min} {name}",inner:"between {down} and {up} {name}",upper:"more than {max} {name}"},animationDuration:500,nextSelector:false,previousSelector:false,itemNamespace:"cal-heatmap",tooltip:false,onClick:null,afterLoad:null,afterLoadNextDomain:null,afterLoadPreviousDomain:null,onComplete:null,afterLoadData:function(e){return e},onMaxDomainReached:null,onMinDomainReached:null};this._domainType={min:{name:"minute",level:10,maxItemNumber:60,defaultRowNumber:10,defaultColumnNumber:6,row:function(t){return e.getSubDomainRowNumber(t)},column:function(t){return e.getSubDomainColumnNumber(t)},position:{x:function(t){return Math.floor(t.getMinutes()/e._domainType.min.row(t))},y:function(t){return t.getMinutes()%e._domainType.min.row(t)}},format:{date:"%H:%M, %A %B %-e, %Y",legend:"",connector:"at"},extractUnit:function(e){return(new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes())).getTime()}},hour:{name:"hour",level:20,maxItemNumber:function(t){switch(e.options.domain){case"day":return 24;case"week":return 24*7;case"month":return 24*(e.options.domainDynamicDimension?e.getDayCountInMonth(t):31)}},defaultRowNumber:6,defaultColumnNumber:function(t){switch(e.options.domain){case"day":return 4;case"week":return 28;case"month":return e.options.domainDynamicDimension?e.getDayCountInMonth(t):31}},row:function(t){return e.getSubDomainRowNumber(t)},column:function(t){return e.getSubDomainColumnNumber(t)},position:{x:function(t){if(e.options.domain==="month"){if(e.options.colLimit>0||e.options.rowLimit>0){return Math.floor((t.getHours()+(t.getDate()-1)*24)/e._domainType.hour.row(t))}return Math.floor(t.getHours()/e._domainType.hour.row(t))+(t.getDate()-1)*4}else if(e.options.domain==="week"){if(e.options.colLimit>0||e.options.rowLimit>0){return Math.floor((t.getHours()+e.getWeekDay(t)*24)/e._domainType.hour.row(t))}return Math.floor(t.getHours()/e._domainType.hour.row(t))+e.getWeekDay(t)*4}return Math.floor(t.getHours()/e._domainType.hour.row(t))},y:function(t){var n=t.getHours();if(e.options.colLimit>0||e.options.rowLimit>0){switch(e.options.domain){case"month":n+=(t.getDate()-1)*24;break;case"week":n+=e.getWeekDay(t)*24;break}}return Math.floor(n%e._domainType.hour.row(t))}},format:{date:"%Hh, %A %B %-e, %Y",legend:"%H:00",connector:"at"},extractUnit:function(e){return(new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours())).getTime()}},day:{name:"day",level:30,maxItemNumber:function(t){switch(e.options.domain){case"week":return 7;case"month":return e.options.domainDynamicDimension?e.getDayCountInMonth(t):31;case"year":return e.options.domainDynamicDimension?e.getDayCountInYear(t):366}},defaultColumnNumber:function(t){t=new Date(t);switch(e.options.domain){case"week":return 1;case"month":return e.options.domainDynamicDimension&&!e.options.verticalOrientation?e.getWeekNumber(new Date(t.getFullYear(),t.getMonth()+1,0))-e.getWeekNumber(t)+1:6;case"year":return e.options.domainDynamicDimension?e.getWeekNumber(new Date(t.getFullYear(),11,31))-e.getWeekNumber(new Date(t.getFullYear(),0))+1:54}},defaultRowNumber:7,row:function(t){return e.getSubDomainRowNumber(t)},column:function(t){return e.getSubDomainColumnNumber(t)},position:{x:function(t){switch(e.options.domain){case"week":return Math.floor(e.getWeekDay(t)/e._domainType.day.row(t));case"month":if(e.options.colLimit>0||e.options.rowLimit>0){return Math.floor((t.getDate()-1)/e._domainType.day.row(t))}return e.getWeekNumber(t)-e.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));case"year":if(e.options.colLimit>0||e.options.rowLimit>0){return Math.floor((e.getDayOfYear(t)-1)/e._domainType.day.row(t))}return e.getWeekNumber(t)}},y:function(t){var n=e.getWeekDay(t);if(e.options.colLimit>0||e.options.rowLimit>0){switch(e.options.domain){case"year":n=e.getDayOfYear(t)-1;break;case"week":n=e.getWeekDay(t);break;case"month":n=t.getDate()-1;break}}return Math.floor(n%e._domainType.day.row(t))}},format:{date:"%A %B %-e, %Y",legend:"%e %b",connector:"on"},extractUnit:function(e){return(new Date(e.getFullYear(),e.getMonth(),e.getDate())).getTime()}},week:{name:"week",level:40,maxItemNumber:54,defaultColumnNumber:function(t){t=new Date(t);switch(e.options.domain){case"year":return e._domainType.week.maxItemNumber;case"month":return e.getWeekNumber(new Date(t.getFullYear(),t.getMonth()+1,0))-e.getWeekNumber(t)}},defaultRowNumber:1,row:function(t){return e.getSubDomainRowNumber(t)},column:function(t){return e.getSubDomainColumnNumber(t)},position:{x:function(t){switch(e.options.domain){case"year":return Math.floor(e.getWeekNumber(t)/e._domainType.week.row(t));case"month":return Math.floor(e.getMonthWeekNumber(t)/e._domainType.week.row(t))}},y:function(t){return e.getWeekNumber(t)%e._domainType.week.row(t)}},format:{date:"%B Week #%W",legend:"%B Week #%W",connector:"in"},extractUnit:function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());var n=t.getDay()-1;if(n<0){n=6}t.setDate(t.getDate()-n);return t.getTime()}},month:{name:"month",level:50,maxItemNumber:12,defaultColumnNumber:12,defaultRowNumber:1,row:function(){return e.getSubDomainRowNumber()},column:function(){return e.getSubDomainColumnNumber()},position:{x:function(t){return Math.floor(t.getMonth()/e._domainType.month.row(t))},y:function(t){return t.getMonth()%e._domainType.month.row(t)}},format:{date:"%B %Y",legend:"%B",connector:"in"},extractUnit:function(e){return(new Date(e.getFullYear(),e.getMonth())).getTime()}},year:{name:"year",level:60,row:function(){return e.options.rowLimit||1},column:function(){return e.options.colLimit||1},position:{x:function(){return 1},y:function(){return 1}},format:{date:"%Y",legend:"%Y",connector:"in"},extractUnit:function(e){return(new Date(e.getFullYear())).getTime()}}};for(var t in this._domainType){if(this._domainType.hasOwnProperty(t)){var n=this._domainType[t];this._domainType["x_"+t]={name:"x_"+t,level:n.type,maxItemNumber:n.maxItemNumber,defaultRowNumber:n.defaultRowNumber,defaultColumnNumber:n.defaultColumnNumber,row:n.column,column:n.row,position:{x:n.position.y,y:n.position.x},format:n.format,extractUnit:n.extractUnit}}}this.lastInsertedSvg=null;this._completed=false;this._domains=d3.map();this.graphDim={width:0,height:0};this.legendDim={width:0,height:0};this.NAVIGATE_LEFT=1;this.NAVIGATE_RIGHT=2;this.RESET_ALL_ON_UPDATE=0;this.RESET_SINGLE_ON_UPDATE=1;this.APPEND_ON_UPDATE=2;this.DEFAULT_LEGEND_MARGIN=10;this.root=null;this.tooltip=null;this._maxDomainReached=false;this._minDomainReached=false;this.domainPosition=new DomainPosition;this.Legend=null;this.legendScale=null;this.DSTDomain=[];this._init=function(){e.getDomain(e.options.start).map(function(e){return e.getTime()}).map(function(t){e._domains.set(t,e.getSubDomain(t).map(function(t){return{t:e._domainType[e.options.subDomain].extractUnit(t),v:null}}))});e.root=d3.select(e.options.itemSelector).append("svg").attr("class","cal-heatmap-container");e.tooltip=d3.select(e.options.itemSelector).attr("style",function(){var t=d3.select(e.options.itemSelector).attr("style");return(t!==null?t:"")+"position:relative;"}).append("div").attr("class","ch-tooltip");e.root.attr("x",0).attr("y",0).append("svg").attr("class","graph");e.Legend=new Legend(e);if(e.options.paintOnLoad){r()}return true};this.paint=function(t){function f(n,r,i,s){var a=0;switch(t){case false:a=r[i];r[i]+=s;e.domainPosition.setPosition(n,a);return a;case e.NAVIGATE_RIGHT:e.domainPosition.setPosition(n,r[i]);o=s;u=e.domainPosition.getPositionFromIndex(1);e.domainPosition.shiftRightBy(u);return r[i];case e.NAVIGATE_LEFT:a=-s;o=-a;u=r[i]-e.domainPosition.getLast();e.domainPosition.setPosition(n,a);e.domainPosition.shiftLeftBy(o);return a}}function p(t){switch(n.label.rotate){case"right":t.attr("transform",function(t){var r="rotate(90), ";switch(n.label.position){case"right":r+="translate(-"+i(t)+" , -"+i(t)+")";break;case"left":r+="translate(0, -"+e.domainHorizontalLabelWidth+")";break}return r});break;case"left":t.attr("transform",function(t){var r="rotate(270), ";switch(n.label.position){case"right":r+="translate(-"+(i(t)+e.domainHorizontalLabelWidth)+" , "+i(t)+")";break;case"left":r+="translate(-"+e.domainHorizontalLabelWidth+" , "+e.domainHorizontalLabelWidth+")";break}return r});break}}var n=e.options;if(arguments.length===0){t=false}var r=e.root.select(".graph").selectAll(".graph-domain").data(function(){var n=e.getDomainKeys();return t===e.NAVIGATE_LEFT?n.reverse():n},function(e){return e});var o=0;var u=0;var a=r.enter().append("svg").attr("width",function(e){return i(e,true)}).attr("height",function(e){return s(e,true)}).attr("x",function(t){if(n.verticalOrientation){e.graphDim.width=Math.max(e.graphDim.width,i(t,true));return 0}else{return f(t,e.graphDim,"width",i(t,true))}}).attr("y",function(t){if(n.verticalOrientation){return f(t,e.graphDim,"height",s(t,true))}else{e.graphDim.height=Math.max(e.graphDim.height,s(t,true));return 0}}).attr("class",function(t){var r="graph-domain";var i=new Date(t);switch(n.domain){case"hour":r+=" h_"+i.getHours();case"day":r+=" d_"+i.getDate()+" dy_"+i.getDay();case"week":r+=" w_"+e.getWeekNumber(i);case"month":r+=" m_"+(i.getMonth()+1);case"year":r+=" y_"+i.getFullYear()}return r});e.lastInsertedSvg=a;a.append("rect").attr("width",function(e){return i(e,true)-n.domainGutter-n.cellPadding}).attr("height",function(e){return s(e,true)-n.domainGutter-n.cellPadding}).attr("class","domain-background");var l=a.append("svg").attr("x",function(){if(n.label.position==="left"){return e.domainHorizontalLabelWidth+n.domainMargin[3]}else{return n.domainMargin[3]}}).attr("y",function(){if(n.label.position==="top"){return e.domainVerticalLabelHeight+n.domainMargin[0]}else{return n.domainMargin[0]}}).attr("class","graph-subdomain-group");var c=l.selectAll("g").data(function(t){return e._domains.get(t)}).enter().append("g");c.append("rect").attr("class",function(t){return"graph-rect"+e.getHighlightClassName(t.t)+(n.onClick!==null?" hover_cursor":"")}).attr("width",n.cellSize).attr("height",n.cellSize).attr("x",function(t){return e.positionSubDomainX(t.t)}).attr("y",function(t){return e.positionSubDomainY(t.t)}).on("click",function(t){if(n.onClick!==null){return e.onClick(new Date(t.t),t.v)}}).call(function(t){if(n.cellRadius>0){t.attr("rx",n.cellRadius).attr("ry",n.cellRadius)}if(e.legendScale!==null&&n.legendColors!==null&&n.legendColors.hasOwnProperty("base")){t.attr("fill",n.legendColors.base)}if(n.tooltip){t.on("mouseover",function(t){var r=this.parentNode.parentNode;e.tooltip.html(e.getSubDomainTitle(t)).attr("style","display: block;");var i=e.positionSubDomainX(t.t)-e.tooltip[0][0].offsetWidth/2+n.cellSize/2;var s=e.positionSubDomainY(t.t)-e.tooltip[0][0].offsetHeight-n.cellSize/2;i+=parseInt(r.getAttribute("x"),10);s+=parseInt(r.getAttribute("y"),10);i+=parseInt(e.root.select(".graph").attr("x"),10);s+=parseInt(e.root.select(".graph").attr("y"),10);i+=parseInt(r.parentNode.getAttribute("x"),10);s+=parseInt(r.parentNode.getAttribute("y"),10);e.tooltip.attr("style","display: block; "+"left: "+i+"px; "+"top: "+s+"px;")});t.on("mouseout",function(){e.tooltip.attr("style","display:none").html("")})}});if(!n.tooltip){c.append("title").text(function(t){return e.formatDate(new Date(t.t),n.subDomainDateFormat)})}if(n.domainLabelFormat!==""){a.append("text").attr("class","graph-label").attr("y",function(t){var r=n.domainMargin[0];switch(n.label.position){case"top":r+=e.domainVerticalLabelHeight/2;break;case"bottom":r+=s(t)+e.domainVerticalLabelHeight/2}return r+n.label.offset.y*(n.label.rotate==="right"&&n.label.position==="right"||n.label.rotate==="left"&&n.label.position==="left"?-1:1)}).attr("x",function(t){var r=n.domainMargin[3];switch(n.label.position){case"right":r+=i(t);break;case"bottom":case"top":r+=i(t)/2}if(n.label.align==="right"){return r+e.domainHorizontalLabelWidth-n.label.offset.x*(n.label.rotate==="right"?-1:1)}return r+n.label.offset.x}).attr("text-anchor",function(){switch(n.label.align){case"start":case"left":return"start";case"end":case"right":return"end";default:return"middle"}}).attr("dominant-baseline",function(){return e.verticalDomainLabel?"middle":"top"}).text(function(t){return e.formatDate(new Date(t),n.domainLabelFormat)}).call(p)}if(n.subDomainTextFormat!==null){c.append("text").attr("class",function(t){return"subdomain-text"+e.getHighlightClassName(t.t)}).attr("x",function(t){return e.positionSubDomainX(t.t)+n.cellSize/2}).attr("y",function(t){return e.positionSubDomainY(t.t)+n.cellSize/2}).attr("text-anchor","middle").attr("dominant-baseline","central").text(function(t){return e.formatDate(new Date(t.t),n.subDomainTextFormat)})}if(t!==false){r.transition().duration(n.animationDuration).attr("x",function(t){return n.verticalOrientation?0:e.domainPosition.getPosition(t)}).attr("y",function(t){return n.verticalOrientation?e.domainPosition.getPosition(t):0})}var d=e.graphDim.width;var v=e.graphDim.height;if(n.verticalOrientation){e.graphDim.height+=o-u}else{e.graphDim.width+=o-u}r.exit().transition().duration(n.animationDuration).attr("x",function(r){if(n.verticalOrientation){return 0}else{switch(t){case e.NAVIGATE_LEFT:return Math.min(e.graphDim.width,d);case e.NAVIGATE_RIGHT:return-i(r,true)}}}).attr("y",function(r){if(n.verticalOrientation){switch(t){case e.NAVIGATE_LEFT:return Math.min(e.graphDim.height,v);case e.NAVIGATE_RIGHT:return-s(r,true)}}else{return 0}}).remove();e.resize()}};CalHeatMap.prototype={init:function(e){"use strict";function o(e,t,n){if((t&&e===false||e instanceof Element||typeof e==="string")&&e!==""){return true}throw new Error("The "+n+" is not valid")}function u(e){switch(e){case"year":return"month";case"month":return"day";case"week":return"day";case"day":return"hour";default:return"min"}}function a(){if(!t._domainType.hasOwnProperty(n.domain)||n.domain==="min"||n.domain.substring(0,2)==="x_"){throw new Error("The domain '"+n.domain+"' is not valid")}if(!t._domainType.hasOwnProperty(n.subDomain)||n.subDomain==="year"){throw new Error("The subDomain '"+n.subDomain+"' is not valid")}if(t._domainType[n.domain].level<=t._domainType[n.subDomain].level){throw new Error("'"+n.subDomain+"' is not a valid subDomain to '"+n.domain+"'")}return true}function f(){if(!e.hasOwnProperty("label")||e.hasOwnProperty("label")&&!e.label.hasOwnProperty("align")){switch(n.label.position){case"left":n.label.align="right";break;case"right":n.label.align="left";break;default:n.label.align="center"}if(n.label.rotate==="left"){n.label.align="right"}else if(n.label.rotate==="right"){n.label.align="left"}}if(!e.hasOwnProperty("label")||e.hasOwnProperty("label")&&!e.label.hasOwnProperty("offset")){if(n.label.position==="left"||n.label.position==="right"){n.label.offset={x:10,y:15}}}}function l(){switch(n.legendVerticalPosition){case"top":n.legendMargin[2]=t.DEFAULT_LEGEND_MARGIN;break;case"bottom":n.legendMargin[0]=t.DEFAULT_LEGEND_MARGIN;break;case"middle":case"center":n.legendMargin[n.legendHorizontalPosition==="right"?3:1]=t.DEFAULT_LEGEND_MARGIN}}function c(e){if(typeof e==="number"){e=[e]}if(!Array.isArray(e)){console.log("Margin only takes an integer or an array of integers");e=[0]}switch(e.length){case 1:return[e[0],e[0],e[0],e[0]];case 2:return[e[0],e[1],e[0],e[1]];case 3:return[e[0],e[1],e[2],e[1]];case 4:return e;default:return e.slice(0,4)}}function h(e){if(typeof e==="string"){return[e,e+(e!==""?"s":"")]}if(Array.isArray(e)){if(e.length===1){return[e[0],e[0]+"s"]}else if(e.length>2){return e.slice(0,2)}return e}return["item","items"]}function p(e){return e>0?e:null}function d(e){if(e>0&&n.colLimit>0){console.log("colLimit and rowLimit are mutually exclusive, rowLimit will be ignored");return null}return e>0?e:null}var t=this;var n=t.options=mergeRecursive(t.options,e);a();o(n.itemSelector,false,"itemSelector");if(t.allowedDataType.indexOf(n.dataType)===-1){throw new Error("The data type '"+n.dataType+"' is not valid data type")}if(d3.select(n.itemSelector)[0][0]===null){throw new Error("The node '"+n.itemSelector+"' specified in itemSelector does not exists")}try{o(n.nextSelector,true,"nextSelector");o(n.previousSelector,true,"previousSelector")}catch(r){console.log(r.message);return false}if(!e.hasOwnProperty("subDomain")){this.options.subDomain=u(e.domain)}if(typeof n.itemNamespace!=="string"||n.itemNamespace===""){console.log("itemNamespace can not be empty, falling back to cal-heatmap");n.itemNamespace="cal-heatmap"}var i=["data","onComplete","onClick","afterLoad","afterLoadData","afterLoadPreviousDomain","afterLoadNextDomain"];for(var s in i){if(e.hasOwnProperty(i[s])){n[i[s]]=e[i[s]]}}n.subDomainDateFormat=typeof n.subDomainDateFormat==="string"||typeof n.subDomainDateFormat==="function"?n.subDomainDateFormat:this._domainType[n.subDomain].format.date;n.domainLabelFormat=typeof n.domainLabelFormat==="string"||typeof n.domainLabelFormat==="function"?n.domainLabelFormat:this._domainType[n.domain].format.legend;n.subDomainTextFormat=typeof n.subDomainTextFormat==="string"&&n.subDomainTextFormat!==""||typeof n.subDomainTextFormat==="function"?n.subDomainTextFormat:null;n.domainMargin=c(n.domainMargin);n.legendMargin=c(n.legendMargin);n.highlight=t.expandDateSetting(n.highlight);n.itemName=h(n.itemName);n.colLimit=p(n.colLimit);n.rowLimit=d(n.rowLimit);if(!e.hasOwnProperty("legendMargin")){l()}f();return this._init()},expandDateSetting:function(e){"use strict";if(!Array.isArray(e)){e=[e]}return e.map(function(e){if(e==="now"){return new Date}if(e instanceof Date){return e}return false}).filter(function(e){return e!==false})},fill:function(e){"use strict";function i(e){if(t.legendScale===null){return false}e.attr("fill",function(e){if(e.v===null&&n.hasOwnProperty("considerMissingDataAsZero")&&!n.considerMissingDataAsZero){if(n.legendColors.hasOwnProperty("base")){return n.legendColors.base}}if(n.legendColors!==null&&n.legendColors.hasOwnProperty("empty")&&(e.v===0||e.v===null&&n.hasOwnProperty("considerMissingDataAsZero")&&n.considerMissingDataAsZero)){return n.legendColors.empty}if(e.v<0&&n.legend[0]>0&&n.legendColors!==null&&n.legendColors.hasOwnProperty("overflow")){return n.legendColors.overflow}return t.legendScale(Math.min(e.v,n.legend[n.legend.length-1]))})}function s(e){if(typeof n.subDomainTextFormat==="function"){e.text(function(e){return n.subDomainTextFormat(e.t,e.v)})}}var t=this;var n=t.options;if(arguments.length===0){e=t.root.selectAll(".graph-domain")}var r=e.selectAll("svg").selectAll("g").data(function(e){return t._domains.get(e)});r.transition().duration(n.animationDuration).select("rect").attr("class",function(e){var r=t.getHighlightClassName(e.t).trim().split(" ");var i=t.dateIsLessThan(e.t,new Date);if(t.legendScale===null||e.v===null&&n.hasOwnProperty("considerMissingDataAsZero")&&!n.considerMissingDataAsZero&&!n.legendColors.hasOwnProperty("base")){r.push("graph-rect")}if(!i&&r.indexOf("now")===-1){r.push("future")}if(e.v!==null){r.push(t.Legend.getClass(e.v,t.legendScale===null))}else if(n.considerMissingDataAsZero&&i){r.push(t.Legend.getClass(0,t.legendScale===null))}if(n.onClick!==null){r.push("hover_cursor")}return r.join(" ")}).call(i);r.transition().duration(n.animationDuration).select("title").text(function(e){return t.getSubDomainTitle(e)});r.transition().duration(n.animationDuration).select("text").attr("class",function(e){return"subdomain-text"+t.getHighlightClassName(e.t)}).call(s)},triggerEvent:function(e,t,n){"use strict";if(arguments.length===3&&n||this.options[e]===null){return true}if(typeof this.options[e]==="function"){if(typeof t==="function"){t=t()}return this.options[e].apply(this,t)}else{console.log("Provided callback for "+e+" is not a function.");return false}},onClick:function(e,t){"use strict";return this.triggerEvent("onClick",[e,t])},afterLoad:function(){"use strict";return this.triggerEvent("afterLoad")},onComplete:function(){"use strict";var e=this.triggerEvent("onComplete",[],this._completed);this._completed=true;return e},afterLoadPreviousDomain:function(e){"use strict";var t=this;return this.triggerEvent("afterLoadPreviousDomain",function(){var n=t.getSubDomain(e);return[n.shift(),n.pop()]})},afterLoadNextDomain:function(e){"use strict";var t=this;return this.triggerEvent("afterLoadNextDomain",function(){var n=t.getSubDomain(e);return[n.shift(),n.pop()]})},onMinDomainReached:function(e){"use strict";this._minDomainReached=e;return this.triggerEvent("onMinDomainReached",[e])},onMaxDomainReached:function(e){"use strict";this._maxDomainReached=e;return this.triggerEvent("onMaxDomainReached",[e])},checkIfMinDomainIsReached:function(e,t){"use strict";if(this.minDomainIsReached(e)){this.onMinDomainReached(true)}if(arguments.length===2){if(this._maxDomainReached&&!this.maxDomainIsReached(t)){this.onMaxDomainReached(false)}}},checkIfMaxDomainIsReached:function(e,t){"use strict";if(this.maxDomainIsReached(e)){this.onMaxDomainReached(true)}if(arguments.length===2){if(this._minDomainReached&&!this.minDomainIsReached(t)){this.onMinDomainReached(false)}}},formatNumber:d3.format(",g"),formatDate:function(e,t){"use strict";if(arguments.length<2){t="title"}if(typeof t==="function"){return t(e)}else{var n=d3.time.format(t);return n(e)}},getSubDomainTitle:function(e){"use strict";if(e.v===null&&!this.options.considerMissingDataAsZero){return this.options.subDomainTitleFormat.empty.format({date:this.formatDate(new Date(e.t),this.options.subDomainDateFormat)})}else{var t=e.v;if(t===null&&this.options.considerMissingDataAsZero){t=0}return this.options.subDomainTitleFormat.filled.format({count:this.formatNumber(t),name:this.options.itemName[t!==1?1:0],connector:this._domainType[this.options.subDomain].format.connector,date:this.formatDate(new Date(e.t),this.options.subDomainDateFormat)})}},loadNextDomain:function(e){"use strict";if(this._maxDomainReached||e===0){return false}var t=this.loadNewDomains(this.NAVIGATE_RIGHT,this.getDomain(this.getNextDomain(),e));this.afterLoadNextDomain(t.end);this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(),t.start);return true},loadPreviousDomain:function(e){"use strict";if(this._minDomainReached||e===0){return false}var t=this.loadNewDomains(this.NAVIGATE_LEFT,this.getDomain(this.getDomainKeys()[0],-e).reverse());this.afterLoadPreviousDomain(t.start);this.checkIfMinDomainIsReached(t.start,t.end);return true},loadNewDomains:function(e,t){"use strict";function u(e){return{t:n._domainType[n.options.subDomain].extractUnit(e),v:null}}var n=this;var r=e===this.NAVIGATE_LEFT;var i=-1;var s=t.length;var o=this.getDomainKeys();while(++i<s){if(r&&this.minDomainIsReached(t[i])){t=t.slice(0,i+1);break}if(!r&&this.maxDomainIsReached(t[i])){t=t.slice(0,i);break}}t=t.slice(-this.options.range);for(i=0,s=t.length;i<s;i++){this._domains.set(t[i].getTime(),this.getSubDomain(t[i]).map(u));this._domains.remove(r?o.pop():o.shift())}o=this.getDomainKeys();if(r){t=t.reverse()}this.paint(e);this.getDatas(this.options.data,t[0],this.getSubDomain(t[t.length-1]).pop(),function(){n.fill(n.lastInsertedSvg)});return{start:t[r?0:1],end:o[o.length-1]}},maxDomainIsReached:function(e){"use strict";return this.options.maxDate!==null&&this.options.maxDate.getTime()<e},minDomainIsReached:function(e){"use strict";return this.options.minDate!==null&&this.options.minDate.getTime()>=e},getDomainKeys:function(){"use strict";return this._domains.keys().map(function(e){return parseInt(e,10)}).sort(function(e,t){return e-t})},positionSubDomainX:function(e){"use strict";var t=this._domainType[this.options.subDomain].position.x(new Date(e));return t*this.options.cellSize+t*this.options.cellPadding},positionSubDomainY:function(e){"use strict";var t=this._domainType[this.options.subDomain].position.y(new Date(e));return t*this.options.cellSize+t*this.options.cellPadding},getSubDomainColumnNumber:function(e){"use strict";if(this.options.rowLimit>0){var t=this._domainType[this.options.subDomain].maxItemNumber;if(typeof t==="function"){t=t(e)}return Math.ceil(t/this.options.rowLimit)}var n=this._domainType[this.options.subDomain].defaultColumnNumber;if(typeof n==="function"){n=n(e)}return this.options.colLimit||n},getSubDomainRowNumber:function(e){"use strict";if(this.options.colLimit>0){var t=this._domainType[this.options.subDomain].maxItemNumber;if(typeof t==="function"){t=t(e)}return Math.ceil(t/this.options.colLimit)}var n=this._domainType[this.options.subDomain].defaultRowNumber;if(typeof n==="function"){n=n(e)}return this.options.rowLimit||n},getHighlightClassName:function(e){"use strict";e=new Date(e);if(this.options.highlight.length>0){for(var t in this.options.highlight){if(this.options.highlight[t]instanceof Date&&this.dateIsEqual(this.options.highlight[t],e)){return" highlight"+(this.isNow(this.options.highlight[t])?" now":"")}}}return""},isNow:function(e){"use strict";return this.dateIsEqual(e,new Date)},dateIsEqual:function(e,t){"use strict";switch(this.options.subDomain){case"x_min":case"min":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()&&e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes();case"x_hour":case"hour":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()&&e.getHours()===t.getHours();case"x_day":case"day":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate();case"x_week":case"week":return e.getFullYear()===t.getFullYear()&&this.getWeekNumber(e)===this.getWeekNumber(t);case"x_month":case"month":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth();default:return false}},dateIsLessThan:function(e,t){"use strict";function n(e,t){switch(t){case"x_min":case"min":return(new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes())).getTime();case"x_hour":case"hour":return(new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours())).getTime();case"x_day":case"day":return(new Date(e.getFullYear(),e.getMonth(),e.getDate())).getTime();case"x_week":case"week":case"x_month":case"month":return(new Date(e.getFullYear(),e.getMonth())).getTime();default:return e.getTime()}}if(!(e instanceof Date)){e=new Date(e)}if(!(t instanceof Date)){t=new Date(t)}return n(e,this.options.subDomain)<n(t,this.options.subDomain)},getDayOfYear:d3.time.format("%j"),getWeekNumber:function(e){"use strict";var t=this.options.weekStartOnMonday===true?d3.time.format("%W"):d3.time.format("%U");return t(e)},getMonthWeekNumber:function(e){"use strict";if(typeof e==="number"){e=new Date(e)}var t=this.getWeekNumber(new Date(e.getFullYear(),e.getMonth()));return this.getWeekNumber(e)-t-1},getWeekNumberInYear:function(e){"use strict";if(typeof e==="number"){e=new Date(e)}},getDayCountInMonth:function(e){"use strict";return this.getEndOfMonth(e).getDate()},getDayCountInYear:function(e){"use strict";if(typeof e==="number"){e=new Date(e)}return(new Date(e.getFullYear(),1,29)).getMonth()===1?366:365},getWeekDay:function(e){"use strict";if(this.options.weekStartOnMonday===false){return e.getDay()}return e.getDay()===0?6:e.getDay()-1},getEndOfMonth:function(e){"use strict";if(typeof e==="number"){e=new Date(e)}return new Date(e.getFullYear(),e.getMonth()+1,0)},jumpDate:function(e,t,n){"use strict";var r=new Date(e);switch(n){case"hour":r.setHours(r.getHours()+t);break;case"day":r.setHours(r.getHours()+t*24);break;case"week":r.setHours(r.getHours()+t*24*7);break;case"month":r.setMonth(r.getMonth()+t);break;case"year":r.setFullYear(r.getFullYear()+t)}return new Date(r)},getMinuteDomain:function(e,t){"use strict";var n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());var r=null;if(t instanceof Date){r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours())}else{r=new Date(+n+t*1e3*60)}return d3.time.minutes(Math.min(n,r),Math.max(n,r))},getHourDomain:function(e,t){"use strict";var n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());var r=null;if(t instanceof Date){r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours())}else{r=new Date(n);r.setHours(r.getHours()+t)}var i=d3.time.hours(Math.min(n,r),Math.max(n,r));var s=0;var o=i.length;for(s=0;s<o;s++){if(s>0&&i[s].getHours()===i[s-1].getHours()){this.DSTDomain.push(i[s].getTime());i.splice(s,1);break}}if(typeof t==="number"&&i.length>Math.abs(t)){i.splice(i.length-1,1)}return i},getDayDomain:function(e,t){"use strict";var n=new Date(e.getFullYear(),e.getMonth(),e.getDate());var r=null;if(t instanceof Date){r=new Date(t.getFullYear(),t.getMonth(),t.getDate())}else{r=new Date(n);r=new Date(r.setDate(r.getDate()+parseInt(t,10)))}return d3.time.days(Math.min(n,r),Math.max(n,r))},getWeekDomain:function(e,t){"use strict";var n;if(this.options.weekStartOnMonday===false){n=new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay())}else{if(e.getDay()===1){n=new Date(e.getFullYear(),e.getMonth(),e.getDate())}else if(e.getDay()===0){n=new Date(e.getFullYear(),e.getMonth(),e.getDate());n.setDate(n.getDate()-6)}else{n=new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()+1)}}var r=new Date(n);var i=t;if(typeof t!=="object"){i=new Date(r.setDate(r.getDate()+t*7))}return this.options.weekStartOnMonday===true?d3.time.mondays(Math.min(n,i),Math.max(n,i)):d3.time.sundays(Math.min(n,i),Math.max(n,i))},getMonthDomain:function(e,t){"use strict";var n=new Date(e.getFullYear(),e.getMonth());var r=null;if(t instanceof Date){r=new Date(t.getFullYear(),t.getMonth())}else{r=new Date(n);r=r.setMonth(r.getMonth()+t)}return d3.time.months(Math.min(n,r),Math.max(n,r))},getYearDomain:function(e,t){"use strict";var n=new Date(e.getFullYear(),0);var r=null;if(t instanceof Date){r=new Date(t.getFullYear(),0)}else{r=new Date(e.getFullYear()+t,0)}return d3.time.years(Math.min(n,r),Math.max(n,r))},getDomain:function(e,t){"use strict";if(typeof e==="number"){e=new Date(e)}if(arguments.length<2){t=this.options.range}switch(this.options.domain){case"hour":var n=this.getHourDomain(e,t);if(typeof t==="number"&&n.length<t){if(t>0){n.push(this.getHourDomain(n[n.length-1],2)[1])}else{n.shift(this.getHourDomain(n[0],-2)[0])}}return n;case"day":return this.getDayDomain(e,t);case"week":return this.getWeekDomain(e,t);case"month":return this.getMonthDomain(e,t);case"year":return this.getYearDomain(e,t)}},getSubDomain:function(e){"use strict";if(typeof e==="number"){e=new Date(e)}var t=this;var n=function(e,n){switch(n){case"year":return t.getDayCountInYear(e);case"month":return t.getDayCountInMonth(e);case"week":return 7}};var r=function(e,t){switch(t){case"hour":return 60;case"day":return 60*24;case"week":return 60*24*7}};var i=function(e,n){switch(n){case"day":return 24;case"week":return 168;case"month":return t.getDayCountInMonth(e)*24}};var s=function(e,n){if(n==="month"){var r=new Date(e.getFullYear(),e.getMonth()+1,0);var i=t.getWeekNumber(r);var s=t.getWeekNumber(new Date(e.getFullYear(),e.getMonth()));if(s>i){s=0;i++}return i-s+1}else if(n==="year"){return t.getWeekNumber(new Date(e.getFullYear(),11,31))}};switch(this.options.subDomain){case"x_min":case"min":return this.getMinuteDomain(e,r(e,this.options.domain));case"x_hour":case"hour":return this.getHourDomain(e,i(e,this.options.domain));case"x_day":case"day":return this.getDayDomain(e,n(e,this.options.domain));case"x_week":case"week":return this.getWeekDomain(e,s(e,this.options.domain));case"x_month":case"month":return this.getMonthDomain(e,12)}},getNextDomain:function(e){"use strict";if(arguments.length===0){e=1}return this.getDomain(this.jumpDate(this.getDomainKeys().pop(),e,this.options.domain),1)[0]},getPreviousDomain:function(e){"use strict";if(arguments.length===0){e=1}return this.getDomain(this.jumpDate(this.getDomainKeys().shift(),-e,this.options.domain),1)[0]},getDatas:function(e,t,n,r,i,s){"use strict";var o=this;if(arguments.length<5){i=true}if(arguments.length<6){s=this.APPEND_ON_UPDATE}var u=function(e){if(i!==false){if(typeof i==="function"){e=i(e)}else if(typeof o.options.afterLoadData==="function"){e=o.options.afterLoadData(e)}else{console.log("Provided callback for afterLoadData is not a function.")}}else if(o.options.dataType==="csv"||o.options.dataType==="tsv"){e=this.interpretCSV(e)}o.parseDatas(e,s,t,n);if(typeof r==="function"){r()}};switch(typeof e){case"string":if(e===""){u({});return true}else{switch(this.options.dataType){case"json":d3.json(this.parseURI(e,t,n),u);break;case"csv":d3.csv(this.parseURI(e,t,n),u);break;case"tsv":d3.tsv(this.parseURI(e,t,n),u);break;case"txt":d3.text(this.parseURI(e,t,n),"text/plain",u);break}}return false;case"object":if(e===Object(e)){u(e);return false};default:u({});return true}},parseDatas:function(e,t,n,r){"use strict";if(t===this.RESET_ALL_ON_UPDATE){this._domains.forEach(function(e,t){t.forEach(function(e,t,n){n[t].v=null})})}var i={};var s=function(e){return e.t};for(var o in e){var u=new Date(o*1e3);var a=this.getDomain(u)[0].getTime();if(this.DSTDomain.indexOf(a)>=0){if(this._domains.has(a-3600*1e3)){a-=3600*1e3}}if(isNaN(o)||!e.hasOwnProperty(o)||!this._domains.has(a)||!(a>=+n&&a<+r)){continue}var f=this._domains.get(a);if(!i.hasOwnProperty(a)){i[a]=f.map(s)}var l=i[a].indexOf(this._domainType[this.options.subDomain].extractUnit(u));if(t===this.RESET_SINGLE_ON_UPDATE){f[l].v=e[o]}else{if(!isNaN(f[l].v)){f[l].v+=e[o]}else{f[l].v=e[o]}}}},parseURI:function(e,t,n){"use strict";e=e.replace(/\{\{t:start\}\}/g,t.getTime()/1e3);e=e.replace(/\{\{t:end\}\}/g,n.getTime()/1e3);e=e.replace(/\{\{d:start\}\}/g,t.toISOString());e=e.replace(/\{\{d:end\}\}/g,n.toISOString());return e},interpretCSV:function(e){"use strict";var t={};var n=Object.keys(e[0]);var r,i;for(r=0,i=e.length;r<i;r++){t[e[r][n[0]]]=+e[r][n[1]]}return t},resize:function(){"use strict";var e=this;var t=e.options;var n=t.displayLegend?e.Legend.getDim("width")+t.legendMargin[1]+t.legendMargin[3]:0;var r=t.displayLegend?e.Legend.getDim("height")+t.legendMargin[0]+t.legendMargin[2]:0;var i=e.graphDim.width-t.domainGutter-t.cellPadding;var s=e.graphDim.height-t.domainGutter-t.cellPadding;this.root.transition().duration(t.animationDuration).attr("width",function(){if(t.legendVerticalPosition==="middle"||t.legendVerticalPosition==="center"){return i+n}return Math.max(i,n)}).attr("height",function(){if(t.legendVerticalPosition==="middle"||t.legendVerticalPosition==="center"){return Math.max(s,r)}return s+r});this.root.select(".graph").transition().duration(t.animationDuration).attr("y",function(){if(t.legendVerticalPosition==="top"){return r}return 0}).attr("x",function(){if((t.legendVerticalPosition==="middle"||t.legendVerticalPosition==="center")&&t.legendHorizontalPosition==="left"){return n}return 0})},next:function(e){"use strict";if(arguments.length===0){e=1}return this.loadNextDomain(e)},previous:function(e){"use strict";if(arguments.length===0){e=1}return this.loadPreviousDomain(e)},jumpTo:function(e,t){"use strict";if(arguments.length<2){t=false}var n=this.getDomainKeys();var r=n[0];var i=n[n.length-1];if(e<r){return this.loadPreviousDomain(this.getDomain(r,e).length)}else{if(t){return this.loadNextDomain(this.getDomain(r,e).length)}if(e>i){return this.loadNextDomain(this.getDomain(i,e).length)}}return false},rewind:function(){"use strict";this.jumpTo(this.options.start,true)},update:function(e,t,n){"use strict";if(arguments.length<2){t=true}if(arguments.length<3){n=this.RESET_ALL_ON_UPDATE}var r=this.getDomainKeys();var i=this;this.getDatas(e,new Date(r[0]),this.getSubDomain(r[r.length-1]).pop(),function(){i.fill()},t,n)},setLegend:function(){"use strict";var e=this.options.legend.slice(0);if(arguments.length>=1&&Array.isArray(arguments[0])){this.options.legend=arguments[0]}if(arguments.length>=2){if(Array.isArray(arguments[1])&&arguments[1].length>=2){this.options.legendColors=[arguments[1][0],arguments[1][1]]}else{this.options.legendColors=arguments[1]}}if(arguments.length>0&&!arrayEquals(e,this.options.legend)||arguments.length>=2){this.Legend.buildColors();this.fill()}this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding)},removeLegend:function(){"use strict";if(!this.options.displayLegend){return false}this.options.displayLegend=false;this.Legend.remove();return true},showLegend:function(){"use strict";if(this.options.displayLegend){return false}this.options.displayLegend=true;this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding);return true},highlight:function(e){"use strict";if((this.options.highlight=this.expandDateSetting(e)).length>0){this.fill();return true}return false},destroy:function(e){"use strict";this.root.transition().duration(this.options.animationDuration).attr("width",0).attr("height",0).remove().each("end",function(){if(typeof e==="function"){e()}else if(typeof e!=="undefined"){console.log("Provided callback for destroy() is not a function.")}});return null},getSVG:function(){"use strict";var e={".cal-heatmap-container":{},".graph":{},".graph-rect":{},"rect.highlight":{},"rect.now":{},"text.highlight":{},"text.now":{},".domain-background":{},".graph-label":{},".subdomain-text":{},".q0":{},".qi":{}};for(var t=1,n=this.options.legend.length+1;t<=n;t++){e[".q"+t]={}}var r=this.root;var i=["stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-miterlimit","fill","fill-opacity","fill-rule","marker","marker-start","marker-mid","marker-end","alignement-baseline","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","kerning","text-anchor","shape-rendering","text-transform","font-family","font","font-size","font-weight"];var s=function(t,n,r){if(i.indexOf(n)!==-1){e[t][n]=r}};var o=function(e){return r.select(e)[0][0]};for(var u in e){if(!e.hasOwnProperty(u)){continue}var a=o(u);if(a===null){continue}if("getComputedStyle"in window){var f=getComputedStyle(a,null);if(f.length!==0){for(var l=0;l<f.length;l++){s(u,f.item(l),f.getPropertyValue(f.item(l)))}}else{for(var c in f){if(f.hasOwnProperty(c)){s(u,c,f[c])}}}}else if("currentStyle"in a){var h=a.currentStyle;for(var p in h){s(u,p,h[p])}}}var d='<svg xmlns="http://www.w3.org/2000/svg" '+'xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css"><![CDATA[ ';for(var v in e){d+=v+" {\n";for(var m in e[v]){d+="	"+m+":"+e[v][m]+";\n"}d+="}\n"}d+="]]></style>";d+=(new XMLSerializer).serializeToString(this.root[0][0]);d+="</svg>";return d}};var DomainPosition=function(){"use strict";this.positions=d3.map()};DomainPosition.prototype.getPosition=function(e){"use strict";return this.positions.get(e)};DomainPosition.prototype.getPositionFromIndex=function(e){"use strict";var t=this.getKeys();return this.positions.get(t[e])};DomainPosition.prototype.getLast=function(){"use strict";var e=this.getKeys();return this.positions.get(e[e.length-1])};DomainPosition.prototype.setPosition=function(e,t){"use strict";this.positions.set(e,t)};DomainPosition.prototype.shiftRightBy=function(e){"use strict";this.positions.forEach(function(t,n){this.set(t,n-e)});var t=this.getKeys();this.positions.remove(t[0])};DomainPosition.prototype.shiftLeftBy=function(e){"use strict";this.positions.forEach(function(t,n){this.set(t,n+e)});var t=this.getKeys();this.positions.remove(t[t.length-1])};DomainPosition.prototype.getKeys=function(){"use strict";return this.positions.keys().sort(function(e,t){return parseInt(e,10)-parseInt(t,10)})};var Legend=function(e){"use strict";this.calendar=e;this.computeDim();if(e.options.legendColors!==null){this.buildColors()}};Legend.prototype.computeDim=function(){"use strict";var e=this.calendar.options;this.dim={width:e.legendCellSize*(e.legend.length+1)+e.legendCellPadding*e.legend.length,height:e.legendCellSize}};Legend.prototype.remove=function(){"use strict";this.calendar.root.select(".graph-legend").remove();this.calendar.resize()};Legend.prototype.redraw=function(e){"use strict";function a(e){e.attr("width",s.legendCellSize).attr("height",s.legendCellSize).attr("x",function(e,t){return t*(s.legendCellSize+s.legendCellPadding)})}function f(){switch(s.legendHorizontalPosition){case"right":if(s.legendVerticalPosition==="center"||s.legendVerticalPosition==="middle"){return e+s.legendMargin[3]}return e-t.getDim("width")-s.legendMargin[1];case"middle":case"center":return Math.round(e/2-t.getDim("width")/2);default:return s.legendMargin[3]}}function l(){if(s.legendVerticalPosition==="bottom"){return n.graphDim.height+s.legendMargin[0]-s.domainGutter-s.cellPadding}return s.legendMargin[0]}if(!this.calendar.options.displayLegend){return false}var t=this;var n=this.calendar;var r=n.root;var i;var s=n.options;this.computeDim();var o=s.legend.slice(0);o.push(o[o.length-1]+1);var u=n.root.select(".graph-legend");if(u[0][0]!==null){r=u;i=r.select("g").selectAll("rect").data(o)}else{r=s.legendVerticalPosition==="top"?r.insert("svg",".graph"):r.append("svg");r.attr("x",f()).attr("y",l());i=r.attr("class","graph-legend").attr("height",t.getDim("height")).attr("width",t.getDim("width")).append("g").selectAll().data(o)}i.enter().append("rect").call(a).attr("class",function(e){return n.Legend.getClass(e,n.legendScale===null)}).attr("fill-opacity",0).call(function(e){if(n.legendScale!==null&&s.legendColors!==null&&s.legendColors.hasOwnProperty("base")){e.attr("fill",s.legendColors.base)}}).append("title");i.exit().transition().duration(s.animationDuration).attr("fill-opacity",0).remove();i.transition().delay(function(e,t){return s.animationDuration*t/10}).call(a).attr("fill-opacity",1).call(function(e){e.attr("fill",function(e,t){if(n.legendScale===null){return""}if(t===0){return n.legendScale(e-1)}return n.legendScale(s.legend[t-1])});e.attr("class",function(e){return n.Legend.getClass(e,n.legendScale===null)})});i.select("title").text(function(e,t){if(t===0){return s.legendTitleFormat.lower.format({min:s.legend[t],name:s.itemName[1]})}else if(t===o.length-1){return s.legendTitleFormat.upper.format({max:s.legend[t-1],name:s.itemName[1]})}else{return s.legendTitleFormat.inner.format({down:s.legend[t-1],up:s.legend[t],name:s.itemName[1]})}});r.transition().duration(s.animationDuration).attr("x",f()).attr("y",l()).attr("width",t.getDim("width")).attr("height",t.getDim("height"));r.select("g").transition().duration(s.animationDuration).attr("transform",function(){if(s.legendOrientation==="vertical"){return"rotate(90 "+s.legendCellSize/2+" "+s.legendCellSize/2+")"}return""});n.resize()};Legend.prototype.getDim=function(e){"use strict";var t=this.calendar.options.legendOrientation==="horizontal";switch(e){case"width":return this.dim[t?"width":"height"];case"height":return this.dim[t?"height":"width"]}};Legend.prototype.buildColors=function(){"use strict";var e=this.calendar.options;if(e.legendColors===null){this.calendar.legendScale=null;return false}var t=[];if(Array.isArray(e.legendColors)){t=e.legendColors}else if(e.legendColors.hasOwnProperty("min")&&e.legendColors.hasOwnProperty("max")){t=[e.legendColors.min,e.legendColors.max]}else{e.legendColors=null;return false}var n=e.legend.slice(0);if(n[0]>0){n.unshift(0)}else if(n[0]<0){n.unshift(n[0]-(n[n.length-1]-n[0])/n.length)}var r=d3.scale.linear().range(t).interpolate(d3.interpolateHcl).domain([d3.min(n),d3.max(n)]);var i=n.map(function(e){return r(e)});this.calendar.legendScale=d3.scale.threshold().domain(e.legend).range(i);return true};Legend.prototype.getClass=function(e,t){"use strict";if(e===null||isNaN(e)){return""}var n=[this.calendar.options.legend.length+1];for(var r=0,i=this.calendar.options.legend.length-1;r<=i;r++){if(this.calendar.options.legend[0]>0&&e<0){n=["1","i"];break}if(e<=this.calendar.options.legend[r]){n=[r+1];break}}if(e===0){n.push(0)}n.unshift("");return(n.join(" r")+(t?n.join(" q"):"")).trim()};String.prototype.format=function(){"use strict";var e=this;for(var t in arguments[0]){if(arguments[0].hasOwnProperty(t)){var n=new RegExp("\\{"+t+"\\}","gi");e=e.replace(n,arguments[0][t])}}return e};if(typeof define==="function"&&define.amd){define(["d3"],function(){"use strict";return CalHeatMap})}else if(typeof module==="object"&&module.exports){module.exports=CalHeatMap}else{window.CalHeatMap=CalHeatMap}